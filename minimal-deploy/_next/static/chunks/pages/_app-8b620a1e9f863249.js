(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[888],{1118:function(e,r,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/_app",function(){return s(9597)}])},3343:function(e,r,s){"use strict";s.d(r,{Ho:function(){return AuthProvider},aC:function(){return useAuth}});var t=s(5893),a=s(7294),o=class{async findById(e){try{let r=this.users.find(r=>r.id===e);return r?{...r}:null}catch(e){throw Error("Erro ao buscar usu\xe1rio por ID: ".concat(e.message))}}async findByEmail(e){try{let r=this.users.find(r=>r.email.toLowerCase()===e.toLowerCase());return r?{...r}:null}catch(e){throw Error("Erro ao buscar usu\xe1rio por email: ".concat(e.message))}}async validateCredentials(e,r){try{let s=await this.findByEmail(e);if(!s)return null;let t=s.password===r;return t?{...s}:null}catch(e){throw Error("Erro ao validar credenciais: ".concat(e.message))}}async create(e){try{let r=await this.findByEmail(e.email);if(r)throw Error("Email j\xe1 est\xe1 em uso");let s={id:Date.now().toString(),name:e.name,email:e.email.toLowerCase(),password:e.password,role:e.role||"member",avatar:e.avatar||"/images/avatars/default.jpg",subscription:{status:"trial",plan:"trial",expiresAt:new Date(Date.now()+6048e5)},profile:{joinedAt:new Date,lastLogin:new Date,preferences:{language:e.language||"pt-BR",notifications:!0,autoplay:!0}},progress:{coursesCompleted:0,totalWatchTime:0,certificatesEarned:0,currentStreak:0}};return this.users.push(s),{...s}}catch(e){throw Error("Erro ao criar usu\xe1rio: ".concat(e.message))}}async update(e,r){try{let s=this.users.findIndex(r=>r.id===e);if(-1===s)throw Error("Usu\xe1rio n\xe3o encontrado");let t=this.users[s],a={...t,...r,profile:{...t.profile,...r.profile||{}},subscription:{...t.subscription,...r.subscription||{}},progress:{...t.progress,...r.progress||{}}};return this.users[s]=a,{...a}}catch(e){throw Error("Erro ao atualizar usu\xe1rio: ".concat(e.message))}}async updateLastLogin(e){try{return await this.update(e,{profile:{lastLogin:new Date}})}catch(e){throw Error("Erro ao atualizar \xfaltimo login: ".concat(e.message))}}async updateProgress(e,r){try{let s=await this.findById(e);if(!s)throw Error("Usu\xe1rio n\xe3o encontrado");let t={...s.progress,...r};return await this.update(e,{progress:t})}catch(e){throw Error("Erro ao atualizar progresso: ".concat(e.message))}}async findAll(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{let r=[...this.users];if(e.role&&(r=r.filter(r=>r.role===e.role)),e.subscriptionStatus&&(r=r.filter(r=>r.subscription.status===e.subscriptionStatus)),e.page&&e.limit){let s=(e.page-1)*e.limit,t=s+e.limit;r=r.slice(s,t)}return r.map(e=>({...e}))}catch(e){throw Error("Erro ao listar usu\xe1rios: ".concat(e.message))}}async delete(e){try{let r=this.users.findIndex(r=>r.id===e);if(-1===r)throw Error("Usu\xe1rio n\xe3o encontrado");let s=this.users.splice(r,1)[0];return{...s}}catch(e){throw Error("Erro ao deletar usu\xe1rio: ".concat(e.message))}}async hasPermission(e,r){try{var s;let t=await this.findById(e);if(!t)return!1;return(null===(s=({admin:["read","write","delete","manage_users","manage_content"],member:["read","write_own"],trial:["read_limited"]})[t.role])||void 0===s?void 0:s.includes(r))||!1}catch(e){throw Error("Erro ao verificar permiss\xe3o: ".concat(e.message))}}async hasActiveSubscription(e){try{let r=await this.findById(e);if(!r)return!1;let{status:s,expiresAt:t}=r.subscription,a=new Date;return"active"===s&&new Date(t)>a}catch(e){throw Error("Erro ao verificar assinatura: ".concat(e.message))}}constructor(e=null){this.users=e||[{id:"1",name:"Administrador",email:"admin@apocalypse.academy",password:"admin123",role:"admin",avatar:"/images/avatars/admin.jpg",subscription:{status:"active",plan:"premium",expiresAt:new Date("2024-12-31")},profile:{joinedAt:new Date("2023-01-01"),lastLogin:new Date,preferences:{language:"pt-BR",notifications:!0,autoplay:!0}},progress:{coursesCompleted:12,totalWatchTime:9360,certificatesEarned:8,currentStreak:15}},{id:"2",name:"Membro Apocalypse",email:"membro@apocalypse.academy",password:"membro123",role:"member",avatar:"/images/avatars/member.jpg",subscription:{status:"active",plan:"basic",expiresAt:new Date("2024-06-30")},profile:{joinedAt:new Date("2023-06-15"),lastLogin:new Date(Date.now()-864e5),preferences:{language:"pt-BR",notifications:!0,autoplay:!1}},progress:{coursesCompleted:5,totalWatchTime:4680,certificatesEarned:3,currentStreak:7}},{id:"3",name:"Usu\xe1rio Teste",email:"teste@apocalypse.academy",password:"teste123",role:"member",avatar:"/images/avatars/default.jpg",subscription:{status:"trial",plan:"trial",expiresAt:new Date(Date.now()+6048e5)},profile:{joinedAt:new Date,lastLogin:new Date,preferences:{language:"pt-BR",notifications:!1,autoplay:!0}},progress:{coursesCompleted:0,totalWatchTime:0,certificatesEarned:0,currentStreak:0}}]}},i=class{async authenticate(e,r){try{if(!e||!r)throw Error("Email e senha s\xe3o obrigat\xf3rios");if(!this.isValidEmail(e))throw Error("Email inv\xe1lido");let s=await this.userRepository.validateCredentials(e,r);if(!s)throw Error("Credenciais inv\xe1lidas");if("suspended"===s.status)throw Error("Conta suspensa. Entre em contato com o suporte.");await this.userRepository.updateLastLogin(s.id);let{password:t,...a}=s;return{success:!0,user:a,token:this.generateToken(s.id),message:"Login realizado com sucesso"}}catch(e){return{success:!1,user:null,token:null,message:e.message}}}async register(e){try{let r=this.validateUserData(e);if(!r.valid)throw Error(r.message);let s=await this.userRepository.findByEmail(e.email);if(s)throw Error("Este email j\xe1 est\xe1 cadastrado");let t=await this.userRepository.create({name:e.name.trim(),email:e.email.toLowerCase().trim(),password:e.password,language:e.language||"pt-BR"}),{password:a,...o}=t;return{success:!0,user:o,token:this.generateToken(t.id),message:"Conta criada com sucesso"}}catch(e){return{success:!1,user:null,token:null,message:e.message}}}async getProfile(e){try{let r=await this.userRepository.findById(e);if(!r)throw Error("Usu\xe1rio n\xe3o encontrado");let{password:s,...t}=r;return{success:!0,user:t}}catch(e){return{success:!1,user:null,message:e.message}}}async updateProfile(e,r){try{if(r.email&&!this.isValidEmail(r.email))throw Error("Email inv\xe1lido");if(r.name&&r.name.trim().length<2)throw Error("Nome deve ter pelo menos 2 caracteres");if(r.email){let s=await this.userRepository.findByEmail(r.email);if(s&&s.id!==e)throw Error("Este email j\xe1 est\xe1 em uso")}let s=await this.userRepository.update(e,{...r,email:r.email?r.email.toLowerCase().trim():void 0,name:r.name?r.name.trim():void 0}),{password:t,...a}=s;return{success:!0,user:a,message:"Perfil atualizado com sucesso"}}catch(e){return{success:!1,user:null,message:e.message}}}async changePassword(e,r,s){try{let t=await this.userRepository.findById(e);if(!t)throw Error("Usu\xe1rio n\xe3o encontrado");if(t.password!==r)throw Error("Senha atual incorreta");if(!this.isValidPassword(s))throw Error("Nova senha deve ter pelo menos 6 caracteres");return await this.userRepository.update(e,{password:s}),{success:!0,message:"Senha alterada com sucesso"}}catch(e){return{success:!1,message:e.message}}}async updateProgress(e,r){try{let s=await this.userRepository.findById(e);if(!s)throw Error("Usu\xe1rio n\xe3o encontrado");let t=this.validateProgressData(r),a=await this.userRepository.updateProgress(e,t);return{success:!0,progress:a.progress,message:"Progresso atualizado com sucesso"}}catch(e){return{success:!1,progress:null,message:e.message}}}async checkPermission(e,r){try{let s=await this.userRepository.hasPermission(e,r);return{success:!0,hasPermission:s,permission:r}}catch(e){return{success:!1,hasPermission:!1,message:e.message}}}async checkSubscriptionStatus(e){try{let r=await this.userRepository.findById(e);if(!r)throw Error("Usu\xe1rio n\xe3o encontrado");let s=await this.userRepository.hasActiveSubscription(e),t=r.subscription,a=0;if(t.expiresAt){let e=new Date,r=new Date(t.expiresAt);a=Math.max(0,Math.ceil((r-e)/864e5))}return{success:!0,subscription:{...t,isActive:s,daysRemaining:a,needsRenewal:a<=7&&a>0}}}catch(e){return{success:!1,subscription:null,message:e.message}}}async listUsers(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1?arguments[1]:void 0;try{let s=await this.checkPermission(r,"manage_users");if(!s.hasPermission)throw Error("Acesso negado");let t=await this.userRepository.findAll(e),a=t.map(e=>{let{password:r,...s}=e;return s});return{success:!0,users:a,total:a.length}}catch(e){return{success:!1,users:[],message:e.message}}}async getUserStats(e){try{let r=await this.checkPermission(e,"manage_users");if(!r.hasPermission)throw Error("Acesso negado");let s=await this.userRepository.findAll(),t={totalUsers:s.length,activeSubscriptions:s.filter(e=>"active"===e.subscription.status).length,trialUsers:s.filter(e=>"trial"===e.subscription.status).length,adminUsers:s.filter(e=>"admin"===e.role).length,memberUsers:s.filter(e=>"member"===e.role).length,totalWatchTime:s.reduce((e,r)=>e+(r.progress.totalWatchTime||0),0),totalCertificates:s.reduce((e,r)=>e+(r.progress.certificatesEarned||0),0)};return{success:!0,stats:t}}catch(e){return{success:!1,stats:null,message:e.message}}}isValidEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}isValidPassword(e){return!!e&&"string"==typeof e&&e.trim().length>=6}validateUserData(e){return!e.name||e.name.trim().length<2?{valid:!1,message:"Nome deve ter pelo menos 2 caracteres"}:e.email&&this.isValidEmail(e.email)?e.password&&this.isValidPassword(e.password)?{valid:!0}:{valid:!1,message:"Senha deve ter pelo menos 6 caracteres"}:{valid:!1,message:"Email inv\xe1lido"}}validateProgressData(e){let r={};return"number"==typeof e.coursesCompleted&&e.coursesCompleted>=0&&(r.coursesCompleted=e.coursesCompleted),"number"==typeof e.totalWatchTime&&e.totalWatchTime>=0&&(r.totalWatchTime=e.totalWatchTime),"number"==typeof e.certificatesEarned&&e.certificatesEarned>=0&&(r.certificatesEarned=e.certificatesEarned),"number"==typeof e.currentStreak&&e.currentStreak>=0&&(r.currentStreak=e.currentStreak),r}generateToken(e){return"token_".concat(e,"_").concat(Date.now())}validateToken(e){if(!e||!e.startsWith("token_"))return{valid:!1,userId:null};let r=e.split("_");if(3!==r.length)return{valid:!1,userId:null};let s=r[1],t=parseInt(r[2]),a=Date.now();return a-t>864e5?{valid:!1,userId:null}:{valid:!0,userId:s}}constructor(e=null){this.userRepository=e||new o}};let n=(0,a.createContext)(null),AuthProvider=e=>{let{children:r}=e,[s,o]=(0,a.useState)(null),[c,u]=(0,a.useState)(!0),[l]=(0,a.useState)(()=>new i);(0,a.useEffect)(()=>{let checkAuth=async()=>{try{let e=localStorage.getItem("auth_token"),r=localStorage.getItem("user_data");if(e&&r)try{let e=JSON.parse(r);o(e)}catch(e){console.error("Erro ao parsear dados do usu\xe1rio:",e),localStorage.removeItem("auth_token"),localStorage.removeItem("user_data")}}catch(e){console.error("Erro ao verificar autentica\xe7\xe3o:",e),localStorage.removeItem("auth_token"),localStorage.removeItem("user_data")}finally{u(!1)}};checkAuth()},[]);let login=async(e,r)=>{try{u(!0);let s=await l.authenticate(e,r);if(s.success)return localStorage.setItem("auth_token",s.token),localStorage.setItem("user_data",JSON.stringify(s.user)),o(s.user),{success:!0,message:s.message};return{success:!1,message:s.message}}catch(e){return console.error("Erro no login:",e),{success:!1,message:"Erro interno do servidor"}}finally{u(!1)}},register=async e=>{try{u(!0);let r=await l.register(e);if(r.success)return localStorage.setItem("auth_token",r.token),localStorage.setItem("user_data",JSON.stringify(r.user)),o(r.user),{success:!0,message:r.message};return{success:!1,message:r.message}}catch(e){return console.error("Erro no registro:",e),{success:!1,message:"Erro interno do servidor"}}finally{u(!1)}},updateProfile=async e=>{try{if(!s)throw Error("Usu\xe1rio n\xe3o autenticado");let r=await l.updateProfile(s.id,e);if(!r.success)return{success:!1,message:r.message};{let e=r.user;return localStorage.setItem("user_data",JSON.stringify(e)),o(e),{success:!0,message:r.message}}}catch(e){return console.error("Erro ao atualizar perfil:",e),{success:!1,message:"Erro interno do servidor"}}},changePassword=async(e,r)=>{try{if(!s)throw Error("Usu\xe1rio n\xe3o autenticado");let t=await l.changePassword(s.id,e,r);return{success:t.success,message:t.message}}catch(e){return console.error("Erro ao alterar senha:",e),{success:!1,message:"Erro interno do servidor"}}},updateProgress=async e=>{try{if(!s)throw Error("Usu\xe1rio n\xe3o autenticado");let r=await l.updateProgress(s.id,e);if(!r.success)return{success:!1,message:r.message};{let e={...s,progress:r.progress};return localStorage.setItem("user_data",JSON.stringify(e)),o(e),{success:!0,message:r.message}}}catch(e){return console.error("Erro ao atualizar progresso:",e),{success:!1,message:"Erro interno do servidor"}}},hasPermission=async e=>{try{if(!s)return!1;let r=await l.checkPermission(s.id,e);return r.hasPermission}catch(e){return console.error("Erro ao verificar permiss\xe3o:",e),!1}},hasActiveSubscription=async()=>{try{var e;if(!s)return!1;let r=await l.checkSubscriptionStatus(s.id);return r.success&&(null===(e=r.subscription)||void 0===e?void 0:e.isActive)}catch(e){return console.error("Erro ao verificar assinatura:",e),!1}},getSubscriptionStatus=async()=>{try{if(!s)return null;let e=await l.checkSubscriptionStatus(s.id);return e.success?e.subscription:null}catch(e){return console.error("Erro ao buscar status da assinatura:",e),null}},refreshUser=async()=>{try{if(!s)return;let e=await l.getProfile(s.id);if(e.success){let r=e.user;localStorage.setItem("user_data",JSON.stringify(r)),o(r)}}catch(e){console.error("Erro ao recarregar dados do usu\xe1rio:",e)}};return(0,t.jsx)(n.Provider,{value:{user:s,loading:c,login,register,logout:()=>{localStorage.removeItem("auth_token"),localStorage.removeItem("user_data"),o(null)},isAuthenticated:()=>null!==s,updateProfile,changePassword,refreshUser,updateProgress,hasPermission,hasActiveSubscription,getSubscriptionStatus,userService:l},children:r})},useAuth=()=>{let e=(0,a.useContext)(n);if(!e)throw Error("useAuth deve ser usado dentro de um AuthProvider");return e}},9597:function(e,r,s){"use strict";s.r(r);var t=s(5893);s(415),s(254),s(8671),s(2293),s(8273),s(7185),s(2872),s(8177);var a=s(3343);r.default=function(e){let{Component:r,pageProps:s}=e;return(0,t.jsx)(a.Ho,{children:(0,t.jsx)(r,{...s})})}},8671:function(){},2293:function(){},254:function(){},415:function(){},2872:function(){},8177:function(){},7185:function(){},8273:function(){}},function(e){var __webpack_exec__=function(r){return e(e.s=r)};e.O(0,[774,179],function(){return __webpack_exec__(1118),__webpack_exec__(9974)}),_N_E=e.O()}]);